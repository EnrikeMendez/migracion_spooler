SELECT
  DISTINCT
  TRA.TRACONS_GENERAL, TRA.TRACLAVE, TRA.TRA_CLICLEF CLICLEF, TDCD_PEDIDO_CLIENTE, TDCD.TDCDFACTURA, NVL(CCL.CCL_NOMBRE, WCCL.WCCL_NOMBRE) CLIENTE_FINAL, NVL(DIE.DIE_A_ATENCION_DE, WCCL.WCCLABREVIACION) SUCURSAL,
  NVL(DIE.DIENOMBRE, WCCL.WCCL_NOMBRE) NOMBRE, NVL(CIU.VILNOM, CIUW.VILNOM) || ' (' || NVL(EST.ESTNOMBRE, ESTW.ESTNOMBRE) || ')' CIUDAD, TDCD_ORDEN_COMPRA, lower(to_char(TAEFECHALLEGADA, 'mm/dd/yyyy hh:mi:ss am')) TAEFECHALLEGADA,
  lower(to_char(TDCD_FEC_CITA_PROGRAMADA, 'mm/dd/yyyy hh:mi:ss am')) TDCD_FEC_CITA_PROGRAMADA, TCDC_CDAD_BULTOS, TDCDVOLUMEN, EAL.ALLCODIGO CEDIS, 'CROSS DOCK' CROSS_DOCK, TDCD.TDCDCLAVE, EXP.EXP_NUM_EXPEDICION, DXP.DXP_TIPO_ENTREGA, DIE.DIEVILLE, TDCDCOLLECT_PREPAID,
  TRA.TRA_MEZTCLAVE_ORI, TRA.TRA_MEZTCLAVE_DEST, EALINFL.ALLCODIGO CED_DEST, TDCD_DXPCLAVE_ORI DXPCLAVE_ORI, TRA.TRA_ALLCLAVE, DXP.DXPCLAVE DXPCLAVE, CLINOM, TRA.CREATED_BY, TO_CHAR( (DXP_REC.DXP_FECHA_ENTREGA) , 'DD/MM/YYYY') F_ENTREGA, DXP_REC.DXP_AUTORIZA_RECHAZO AUTORIZA
  FROM  (select * from ETRANSFERENCIA_TRADING where DATE_CREATED >= TRUNC(SYSDATE) - 360 ) TRA left join ( select * from ETRANS_DETALLE_CROSS_DOCK where DATE_CREATED >= TRUNC(SYSDATE) - 360  ) TDCD on (TDCD_TRACLAVE) = (TRA.TRACLAVE)
  left join ECLIENT CLI on (CLICLEF) = (TRA_CLICLEF) left join (select * from EALMACENES_LOGIS ) EAL on (TRA.TRA_ALLCLAVE) = (eal.allclave) left join ECLIENT_CLIENTE CCL on (CCL.CCLCLAVE) = (TDCD_CCLCLAVE)
  left join EDIRECCIONES_ENTREGA DIE on DIE.DIECLAVE = NVL((TDCD_DIECLAVE_ENT), (TDCD_DIECLAVE)) left join ECIUDADES CIU on  (CIU.VILCLEF) = (DIE.DIEVILLE) left join EESTADOS EST on (EST.ESTESTADO) = (CIU.VIL_ESTESTADO)
  left join (select * from  ETRANS_ENTRADA where DATE_CREATED >= TRUNC(SYSDATE) - 360  ) TAE on (TAE_TRACLAVE) = (TRA.TRACLAVE) left join (select * from   EDET_EXPEDICIONES where DATE_CREATED >= TRUNC(SYSDATE) - 360  ) DXP on (DXP.DXP_TDCDCLAVE) = (TDCDCLAVE)
  left join (select * from EEXPEDICIONES where DATE_CREATED >= TRUNC(SYSDATE) - 360 ) EXP on (EXP.EXPCLAVE) = (DXP.DXP_EXPCLAVE) left join (select * from WEB_LTL where DATE_CREATED >= TRUNC(SYSDATE) - 360  ) WEL on (WEL.WEL_TDCDCLAVE) = (TDCD.TDCDCLAVE)
  left join WEB_CLIENT_CLIENTE WCCL on  (WCCL.WCCLCLAVE) = (WEL.WEL_WCCLCLAVE) left join ECIUDADES CIUW on (CIUW.VILCLEF) = (WCCL.WCCL_VILLE) left join EESTADOS ESTW on (ESTW.ESTESTADO) = (CIUW.VIL_ESTESTADO)
  left join ( SELECT ETRANS_DETALLE_CROSS_DOCK.TDCDCLAVE,EDESTINOS_POR_RUTA.DER_ALLCLAVE FROM ETRANS_DETALLE_CROSS_DOCK , WEB_LTL , EDESTINOS_POR_RUTA WHERE  WEL_ID_OP = TDCD_ID_OP AND DER_VILCLEF = WEL_VILCLEF_DEST ) TDCDW on (TDCDW.TDCDCLAVE) = (TDCD.TDCDCLAVE)
  left join ( SELECT max(DXPCLAVE) DXPCLAVE ,DXP_ID_OP,max(DXP_AUTORIZA_RECHAZO) DXP_AUTORIZA_RECHAZO, max(DXP_FECHA_ENTREGA)DXP_FECHA_ENTREGA , NVL(DXP_TINCLAVE, 0) FROM EDET_EXPEDICIONES
  WHERE   DXP_TIPO_ENTREGA = 'DIRECTO' AND NVL(DXP_TINCLAVE, 0)  != 0 and not dxp_autoriza_rechazo is null and date_created >= trunc(sysdate) -360 group by DXP_ID_OP, NVL(DXP_TINCLAVE, 0) ) DXP_REC on          trim(DXP_REC.DXP_ID_OP) = trim(TDCD.TDCD_ID_OP)
  left join EALMACENES_LOGIS EALINFL on (EALINFL.ALLCLAVE) = (TDCDW.DER_ALLCLAVE) WHERE EAL.ALLCLAVE = 1 AND TRA.TRACLAVE >= 17300000 AND TRA.TRASTATUS = '1' AND TRA.TRA_MEZTCLAVE_ORI = 0
  AND TRA_MEZTCLAVE_DEST IN (24 ) AND TRA.TRA_ALLCLAVE = 1  AND TRA.TRA_CLICLEF NOT IN (2896, 2897, 3195, 3196, 3109)
  AND TRA.DATE_CREATED >= TRUNC(SYSDATE) - 360 AND TDCD_TRACLAVE = TRA.TRACLAVE AND TDCD.TDCDSTATUS = '1' AND TDCD_DXPCLAVE_ORI IS NOT NULL AND NOT EXISTS
  (SELECT NULL FROM ETRANS_CONVERTIDOR_DET TCOD WHERE (TCOD.TCOD_TDCDCLAVE) = (TDCD.TDCDCLAVE) AND ROWNUM = 1)
  AND NOT EXISTS (SELECT NULL FROM EDET_EXPEDICIONES WHERE (DXP_TDCDCLAVE) = (TDCD.TDCDCLAVE) AND DXP_NDCCLAVE IS NOT NULL AND ROWNUM = 1)
  AND (EXISTS (SELECT  NULL FROM ETRANSFERENCIA_PALETA TDP, ETRANSFERENCIA_TRADING TRA2 WHERE (TDP.TDP_TDCDCLAVE) = (TDCD.TDCDCLAVE) AND (TRA2.TRACLAVE) = (TDP.TDP_TRACLAVE) AND TRA2.TRASTATUS = '1'
  AND TRA2.TRA_MEZTCLAVE_DEST = 2 AND NOT EXISTS ( SELECT NULL FROM ETRANSFERENCIA_PALETA TDP3, ETRANSFERENCIA_TRADING TRA3 WHERE TDP3.TDP_PALCLAVE = TDP.TDP_PALCLAVE AND (TRA3.TRACLAVE) = (TDP3.TDP_TRACLAVE)
  AND (TRA3.TRA_TRACLAVE) = (TRA2.TRACLAVE) AND (TRA3.TRASTATUS) = '1' AND TRA3.TRA_MEZTCLAVE_DEST = 21 AND ROWNUM = 1 ) AND ROWNUM = 1 ) OR NOT EXISTS (SELECT  NULL FROM ETRANSFERENCIA_PALETA TDP, ETRANSFERENCIA_TRADING TRA2
  WHERE (TDP.TDP_TDCDCLAVE) = (TDCD.TDCDCLAVE) AND (TRA2.TRACLAVE) = (TDP.TDP_TRACLAVE) AND (TRA2.TRASTATUS) = '1' AND TRA2.TRA_MEZTCLAVE_DEST IN (97, 6, 7, 99, 57, 2) AND ROWNUM = 1)) AND trim(CLICLEF) = trim(TRA_CLICLEF)